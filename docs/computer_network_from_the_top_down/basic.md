## What's the Internet
- 网络分为3个部分  edge core access(边缘 核心 接入)

## 网络边缘
- 应用层之下都属于基础设施
- 基础设施为分布式应用提供通讯服务


## 网络核心
- 路由器的网络状态
- 基本问题：数据怎样通过网络进行传输?
  * 电路交换：为每个呼叫预留一条专有电路：如电话网
  * 分组交换：
    - 将要传送的数据分成一个个单位：分组
    - 将分组从一个路由器传到相邻路由器(hop),一段段最终从源端到目标端
    - 每段：采用链路的最大传输能力(带宽)

#### 网络核心: 电路交换
- 网络资源(如宽带)被分成片
  * 频分(Frequency-division-multiplexing)
  * 时分(Time-division-multiplexing)

#### 电路交换不适合计算机通信
- 连接建立时间长
- 计算机通信有突发性，如果使用线路交换，则浪费的片比较多
  * 即使这个呼叫没有数据传递，其所占据的片也不能被别的呼叫使用
- 可靠性不高
  * 波分(wave-divisionmultiplexing)

#### 网络核心: 分组交换
- 网络贷款资源不再分为一个个片，传输时使用全部带宽
- 主机之间传输的数据被分为一个个分组
- 资源共享，按需使用
  * 存储，转发：分组每次移动一跳(hop)
    - 在转发之前，节点必须收到整个分组
    - 延迟比线路交换要大
    - 排队时间

#### 分组交换：排队延迟和丢失
- 如果到达速率>链路的输出速率
  * 分组将会排队，等待传输
  * 如果路由器的缓存用完了，分组将会被抛弃

### 网络核心的关键功能
- 路由
  * 决定分组采用的源到目标的路径
- 转发
  * 将分组从路由器的输入链路转移到输出链路

#### 数据报(datagram)的工作原理
- 在通信之前，无需建立起一个连接，有数据就传输
- 每一个分组都独立路由(路径不一样，可能会失序)
- 路由器根据分组的目标地址进行路由

#### 网络分类
```py
         通信网络
         |       |
电路交换网络   分组交换网络
 |   |          |       |
FDM TDM     虚电路网络  数据报网络
```

## 接入网络和物理媒体
#### 怎样将端系统和边缘路由器连接？
- 住宅接入网络 Modem (调制解调器，俗称猫)
  * 将上网数据```调制```加载音频信号上，在电话线上传输，在局端将其中的数据```解调```出来；反之亦然
    - 调频
    - 调幅
    - 调相位
    - 综合调制
  * 拨号调制解调器
    - 56Kbps的速率直接接入路由器(通常更低)
    - 不能同时上网和打电话，不能总是在线
- 接入网：线缆网络
  * 有线电视信号线缆双向改造
  * FMD
    - 在不同频段传输不同信道的数据，数字电视和上网数据(上下行)
- 单位接入网络(学校，公司)
- 无线接入网络
- 注意：
  * 接入网络的带宽(bits pre second)?
  * 共享/专用？

#### 物理媒体
- Bit: 在传输 - 接收对间传播
- 物理链路：在每个传输 - 接受对，跨越一重物理媒体
- 导引型媒体：
  * 信号沿着固体媒介被引导：同轴电缆，光纤，双绞线
- 非导引型媒体：
  * 信号自由传播: 如无线电
- 双绞线(TP)
  * 两根绝缘铜线
    - 5类：100Mbps Ethernet Gbps 以太网
    - 6类：106Gbps


## 互连网络结构：网络的网络
- 端系统通过```接入ISPs```(Intenet Service Providers)连接到互联网
  * 住宅，公司和大学的ISPs
- 接入ISps响应的必须是互联的
  * 因此任何2个端系统可互相发送分组到对方
- 导致的“网络的网络”略微复杂
 * 发展和烟花时通过竞技的和国家的政策来驱动

### Internet结构: network of networks
- 松散的层次模型
- 中心：第一层ISP(如UUNet, BBN/Genuity, Sprint, AT&T)国家/国际覆盖，速率极高
  * 直接与其他第一层ISP相连
  * 与大量的第二层ISP和其他客户网络相连
- 第二层ISP：更小些的(通常是区域性的)ISP
  * 与一个或多个第一层ISPs，也可能与其他第二层ISP
- 第三层ISP与其他本地ISP
  * 接入网(与端系统最近)


## 分组延时，丢包和吞吐量
#### 分组丢失和延时是怎样发生的？
- 在路由器缓冲区的分组队列
  * 分组到达链路的速率超过了链路输出的能力
  * 分组等待排到对头，被传输

#### 4种分组延时
- 1.节点处理延时：
  * 检查bit级差错
  * 检查分组首部和决定将分组导向何处
- 2.排队延时：
  * 在输出链路上等待传输的时间
  * 依赖于路由器的拥塞程度
- 3.传输延时：
  * R=链路带宽(bps)
  * L=分组长度(bits)
  * 将分组发送到链路上的时间=L/R
  * 存储转发延时
- 4.传播延时：
  * d = 物理链路的长度
  * s = 在媒体上的传播速度(~2*10pow(8)m/sec)
  * 传播延时=d/s

#### Internet的延时和路由
- Traceroute 诊断程序：提供从源端，经过路由器，到目的地的延时测量
  * For all i:
    - 沿着目的的路径，向每个路由器发送3个探测分组
    - 路由器i将向发送方返回一个分组
    - 发送方对发送和回复之间间隔计时
```py
windows下的命令为：
tracert targetName
tracert 和 ping 都是基于ICMP协议的
```
#### 吞吐量
- 在源端和目标端之间传输的速率(数据量/单位时间)
  * 瞬间吞吐量：在一个时间点的速率
  * 平均吞吐量：在一个长时间内平均值

## 协议层次
- 网络是一个复杂的系统
- 网络功能繁杂：数字信号的物理信号承载
  - 点到点，路由，rdt，进程区分，应用等
- 现实来看，网络的许多构成元素和设备：
  * 主机，路由器，各种媒体的链路
  * 应用，协议，硬件，软件

#### 服务与协议的联系
- 协议是水平的，服务是垂直的
- 协议需要下层服务提供接口来实现，协议的实现是为了提供更好的服务
- 本层协议的实现要靠下层提供的服务来实现
- 本层实体通过协议为上层提供更高级的服务

#### 服务和服务访问点
- 服务(Service): 低层实体向上层实体提供它们之间的通信的能力
  * 服务用户(service user)
  * 服务提供者(service provider)
- 原语(primitive): 上层使用下层服务的形式，高层使用低层提供的服务
- 以及底层向高层提供服务都是通过服务访问原语来进行交互的

- 服务访问点SAP(Services Access Point):
  * 上层使用下层提供的服务通过层间的接口 - 地点：
  * 例子：邮箱
  * 地址(address): 下层的一个实体支撑着上层的多个实体，
    - SAP也有标志不同上层实体的作用
  * 可以有不同的实现，队列
  * 例子： 传输层的SAP，端口(prot)

#### 服务的类型
- 面向连接的服务和无连接的服务
  * 无连接的服务(Connectionless Service)
    - 无连接服务：
    - 两个对等层实体在通信前不需要建立一个连接
    - 不预留资源，不需要通信双方都是活跃
    - 特点：不可靠，可能重复，可能失序
    - IP分组：数据包
    - 适用范围：适合传送零星数据
    - 服务类型：
      * 不可靠的数据报 电子方式的函件
      * 有确认的数据报 挂号信
      * 请求回答 信息查询

## internet 协议栈
- 应用层：网络应用
  * 为人类用户或其他应用进程提供网络应用服务
  * FTP，SMTP，HTTP，DNS
- 传输层：主机之间的数据传输
  * 在网络层提供的端到端通信基础上，细分为进程到进程
  * 将不可靠的通信编程可靠的通信
  * TCP，UDP
- 网络层：为数据报从源到目的选择路由
  * 主机主机之间的通信，端到端通信，不可靠
  * IP，路由协议
- 链路层：相邻网络节点间的数据传输
  * 2个相邻2点的通信，点到点通信，可靠或不可靠
  * 点对点协议PPP，802.11(wifi),Ethernet
- 物理层: 在线路上传送bit

#### ISO/OSI 参考模型
- 表示层：允许应用解释传输的数据
  * e.g.,加密，压缩，及其相关的表示转换
- 会话层：数据交换的同步，检查点，恢复
-互联网协议栈没有这两层！！！


## 各层次的协议数据单元
- 应用层：报文(message)
- 传输层：报文段(segment):TCP段，UDP数据报
- 网络层：分组packet(如果无连接方式：数据报datagram)
- 数据链路层：帧(frame)
- 物理层: 位(bit)


## 杂项 edge
- 分组交换会涉及丢包，延迟
- 除了互联网还有其他网络(银行专用网络，通信专用网络等)
- 数据节点分为中继器，交换机，路由器
- 互联网是以```TCP，IP```协议为主的一簇协议
- 常见的交换设备(switch(华为，思科生产))
- TCP/UDP工作在IP协议之上
- peer entity 对等层的实体
- 协议数据单元 PDU (Protocol Data Unit)
- ISP(Internet Service Provider)互联网服务提供商
- socket是TCP向应用层提供的服务访问点(类似于端口用来标注)
