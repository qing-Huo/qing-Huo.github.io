## 路由器组成

高层面（非常简化的）通用路由器体系架构
- 路由：运行```路由```选择算法/协议（RIP,OSPF,BGP）生成路由表
- 转发：从输入到输出链路交换数据报-根据路由表进行分组的```转发```

#### 输入端口功能

分布式交换：
- 根据数据报头部的信息如：目的地址，在输入端口内存中的转发表中查找合适的输出端口（匹配+行动）
- ```基于目标的转发:```仅仅依赖于IP数据报的目标IP地址（传统方法）
- ```通用转发:```基于头部字段的任意集合进行转发

#### 输入端口缓存

- 当交换机的速率小于出入端口的汇聚速率时 -> 在输入端口可能要排队
    * ```排队延迟以及由于输入缓存溢出造成丢失！```
- Head-of-the-Line()blocking:排在对头的数据报阻止了队列中其他数据报向前移动

#### 交换结构

- 将分组从输入缓冲区传输到合适的输出端口
- 交换速率：分组可以按照该速率从输入传输到输出
    * 运行速度京城是输入/输出链路速率的若干倍
    * N个输入端口：交换机构的交换速度是输入线路速度的N倍比较理想，才不会成为瓶颈

#### 通过内存交换

第一代路由器：
- 在CPU直接控制下的交换，采用传统的计算机
- 分组被拷贝到系统内存，CPU从分组的头部提取出目标地址，查找转发表，找到对应的输出端口，拷贝到输出端口
- 传法速
###### 通过内存交换

第一代路由器：
- 在CPU直接控制下的交换，采用传统的计算机
- 分组被拷贝到系统内存，CPU从分组的头部提取出目标地址，查找转发表，找到对应的输出端口，拷贝到输出端口
- 转发速率被内存的带宽限制（数据报通过BUS两遍）
- 一次只能转发一个分组

###### 通过总线交换

- 数据报通过共享总线，从输入端口转发到输出端口
- ```总线竞争:```交换速度受限于总线带宽
- 1次处理一个分组
- 1Gbps bus,Cisco 1900： 32Gbps bus,Cisco 5600:对于接入或企业级路由器，速度足够（但不适合区域或骨干网）

###### 通过互联网络（crossbar等）的交换

- 同时并发转发多个分组，克服总线带宽限制
- Banyan(榕树)网络,crossbar(纵横)和其他的互联网络被开发，将多个处理器连接成多处理器
- 当分组从端口A到达，转发给端口Y：控制器短接相应的两个总线
- 高级设计：将数据报分片为固定长度的信元，通过交换网络交换
- Cisco12000：以60Gbps的交换速率通过互联网络

#### 输出端口

- 当数据报从交换机构的到达速度比传输速率快，就需要输出端口```缓存```
    * 数据报（分组）可能会被丢弃,由于用色，缓冲区没有空间
- 由```调度规则```选择排队的数据报进行传输
    * 优先调度权-谁会获得最佳性能，网络中立？
- ```排队带来延迟，由于输出端口缓存溢出则丢弃数据报！```

#### 调度机制

- ```调度:```选择下一个要通过链路传输的分组
- FIFO(First In First Out):按照分组到来的次序发送
- 例子：
    * 丢弃策略：如果分组到达一个满的队列，那个分组将会被丢弃？
        - tail drop:丢弃刚到达的分组
        - priority：根据优先权丢失/移除分组
        - random：随机地丢弃/移除

#### 调度策略：优先权

- ```优先权调度:``` 发送最高优先权的分组
- 多类：不同类别有不同的优先权
    * 类别可能依赖于标记或其他的头部字段:
        - 如：e.g. IP source/dest, port numbers, ds, etc.
    * 先传高优先级的队列中的分组,除非没有
    * 高（低）优先权中的分组传输次序：FIFO
    
#### 调度策略：其他的

Round Robin(RR) scheduling:
- 多类：
- 循环扫描不同类型的队列，发送完一类的一个分组，再发送下一个类的一个分组，循环所有类

Weighted Fair Queuing(WFQ):
- 一般化的Round Robin
- 在一段时间内，每个队列得到的服务时间和权重成正比
- 每个类在一个循环中获得不同权重的服务量












